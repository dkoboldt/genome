#!/usr/bin/env genome-perl

BEGIN { 
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}

use strict;
use warnings;

use above "Genome";
use Test::More;
use Genome::Utility::Test;

my $class = "Genome::Model::Tools::Annotate::Sv::Dbsnp";
use_ok($class);
my $base_dir = Genome::Utility::Test->data_dir($class);
my $version = "1";
my $data_dir = join("/", $base_dir, "v$version");

my $bp_list = {
    1 => [
    {
        chrA => '1',
        bpA => 20971165,
        chrB => '1',
        bpB => 20972052,
        event => 'DEL',
        orient => "+-",
    },
    ],
};

my $expected_output = {
    '1--20971165--1--20972052--DEL' => [
        'rs71646557',
    ],
};

my $annotation_file = $data_dir."/dbsnp";

my $cmd = Genome::Model::Tools::Annotate::Sv::Dbsnp->create(annotation_file => $annotation_file);
ok($cmd, "Created command");
my $output = $cmd->process_breakpoint_list($bp_list);
ok($output, "Process breakpoint list created output");

is_deeply($output, $expected_output, "Got dbsnp") or diag explain [$output, $expected_output]; 

#do the example values for the annotation file exist and have size?
my $p = $cmd->__meta__->property("annotation_file");
my $examples = $p->example_values;
ok($examples, "At least one database exists");
for my $example (@$examples) {
    ok(-s $example, "Database file $example exists and has size");
}

done_testing;


