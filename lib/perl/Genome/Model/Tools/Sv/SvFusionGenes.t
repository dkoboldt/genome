#!/usr/bin/env genome-perl

BEGIN { 
    $ENV{UR_DBI_NO_COMMIT} = 1;
    $ENV{UR_USE_DUMMY_AUTOGENERATED_IDS} = 1;
}

use strict;
use warnings;

use above "Genome";
use Test::More;

use_ok("Genome::Model::Tools::Sv::SvFusionGenes");

my $base_dir = $ENV{GENOME_TEST_INPUTS}."/Genome-Model-Tools-Sv-SvFusionGenes";
my $version = 1;
my $data_dir = "$base_dir/v$version";

my $temp_file = Genome::Sys->create_temp_file_path;
my $cmd = Genome::Model::Tools::Sv::SvFusionGenes->create(
    input_file  => "$base_dir/in.svs",
    output_file => $temp_file,
    annotation_build_id => 102549985,  #54_36p_v2, human Build36
);

ok($cmd, "Created command");

ok($cmd->execute, "Command executed successfully");

my $expected_file = "$data_dir/expected.out";
ok(-s $temp_file, "Output file created");
ok(-s $expected_file, "Expected file exists");
my $expected = `cat $expected_file | sort`;
my $actual = `cat $temp_file | sort`;
my $diff = Genome::Sys->diff_text_vs_text($expected, $actual);
ok(!$diff, "No diffs with expected output");
done_testing;
